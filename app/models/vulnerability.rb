class Vulnerability < ApplicationRecord
  require 'open-uri'
  require 'zip'
  require 'nokogiri'
  require 'date'

  def self.get_nvd_url_for_year(year)
    "https://static.nvd.nist.gov/feeds/xml/cve/2.0/nvdcve-2.0-#{year}.xml.zip"
  end

  def self.load_vulnerabilities_from_nvd_for_year(year)
    update_from_nvd_zip(get_nvd_url_for_year(year))
  end
  
  def self.get_nvd_update_url()
    "https://static.nvd.nist.gov/feeds/xml/cve/2.0/nvdcve-2.0-modified.xml.zip"
  end

  def self.load_zip_content(httpsaddress)
    zip_file = Zip::File.open(open(httpsaddress))
    content = zip_file.first.get_input_stream.read
    content
  end

  def self.load_new_vulnerabilities_from_nvd()
    update_from_nvd_zip(get_nvd_update_url())
  end
  
  def self.update_from_nvd_zip(httpsaddress)
    content = load_zip_content(httpsaddress)
    debugger
  end
end
